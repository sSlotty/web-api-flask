{% extends "base_layout.html" %}

{% block body %}
<!-- Material input -->
<div class="container">
    <div class="row">
        <div class="col-12 col-md-6 col-sm-12">
            <div class="float-right">
                <div class="md-form">
                    <input type="text" id="form1" class="form-control">
                    <label for="form1">Example label</label>
                </div>
            </div>
            
        </div>
        <div class="col-12 col-md-6 col-sm-12">
           <div class="card">
               <div class="card-body">
                    
            <div id="chart">
                
            </div>
               </div>
           </div>
        </div>
    </div>
</div>

<script>
    function GetURLParameter(sParam) {
        var sPageURL = window.location.search.substring(1);
        var sURLVariables = sPageURL.split('&');
        for (var i = 0; i < sURLVariables.length; i++) {
            var sParameterName = sURLVariables[i].split('=');
            if (sParameterName[0] == sParam) {
                return sParameterName[1];

            }
        }
    }


    function loadChart(id) {
        fetch(`\loadChart?id=${id}`).then((response) => {
            response.json().then((data) => {
                var sub_array = [];
                for (var i = 0; i < data['result'].length; i++) {
                    chart_data = {
                        'x': new Date(data['result'][i]['time']),
                        'y': [data['result'][i]['open'],data['result'][i]['high'],data['result'][i]['low'],data['result'][i]['close']]
                    }
                    sub_array.push(chart_data)
                }

                console.log(sub_array)
                var chart = {
                    series:[{
                        data: sub_array
                    }],
                    chart:{
                        type:'candlestick',
                        height: 720,
                        width:1280
                    },
                    title: {
                        text:'candlestick Chart',
                        align: 'left'
                    },
                    xaxis: {
                        type:'datetime'
                    },
                    yaxis: {
                        tooltip: {
                            enabled: true
                        }
                    }
                }
                var setChart = new ApexCharts(document.querySelector("#chart"),chart)
                setChart.render()
            })
        });

        
    }

    var id = GetURLParameter('id');
    loadChart(id)
</script>
{% endblock %}